<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Video Transcoder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" http-equiv="Content-Security-Policy" content="
  default-src 'self';
  connect-src 'self' https://*.s3.ap-southeast-2.amazonaws.com;
  img-src 'self' data: blob: https://*.s3.ap-southeast-2.amazonaws.com;
  media-src 'self' blob: https://*.s3.ap-southeast-2.amazonaws.com;
"/>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; }
    .hidden { display: none; }
    .row { margin: .75rem 0; }
    table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
    th, td { border: 1px solid #ddd; padding: .5rem; text-align: left; vertical-align: top; }
    #status { border: 1px solid #ccc; padding: .75rem; border-radius: 8px; margin-top: 1rem; }
    button { cursor: pointer; }
  </style>
</head>
<body>
  <h1>Video Transcoder</h1>

  <section id="auth">
    <h3>Register:</h3>
    <div class="row">
      <input id="regEmail" placeholder="Email" />
      <input id="regUsername" placeholder="Username" />
      <input id="regPassword" placeholder="Password" type="password" />
      <button id="registerBtn">Register</button>
      <span id="registerMsg"></span>
    </div>

    <h3>Verify your email address:</h3>
    <div class="row">
      <input id="confirmUser" placeholder="Username" />
      <input id="confirmCode" placeholder="Code" />
      <button id="confirmBtn">Confirm</button>
      <span id="confirmMsg"></span>
    </div>

    <h3>Login:</h3>
    <div class="row">
      <input id="username" placeholder="Username" />
      <input id="password" placeholder="Password" type="password" />
      <button id="loginBtn">Login</button>
      <span id="authMsg"></span>
    </div>
    <!-- MFA step (shown after username+password if email OTP is required) -->
<section id="mfa" class="hidden">
  <h3>Verification required</h3>
  <p id="mfaMsg">We sent a code to your email. Enter it below.</p>
  <div class="row">
    <label for="mfaCode">Code</label>
    <input id="mfaCode" type="text" inputmode="numeric" autocomplete="one-time-code" placeholder="6-digit code" />
  </div>
  <div class="row">
    <button id="mfaSubmitBtn">Verify</button>
    <button id="mfaResendBtn" type="button">Resend code</button>
  </div>
</section>

  </section>

  <!-- Logout lives OUTSIDE the auth section -->
  <div id="welcomeBox" class="hidden">Welcome, <strong id="welcomeName"></strong>!</div>
  <div class="row">
    <button id="logoutBtn" class="hidden">Logout</button>
  </div>

  <section id="upload" class="hidden">
    <h3>Upload & Transcode</h3>
    <form id="uploadForm">
      <input type="file" id="video" accept="video/*" />
      <select id="format">
        <option value="mp4">mp4</option>
        <option value="webm">webm</option>
        <option value="mkv">mkv</option>
        <option value="mov">mov</option>
      </select>
      <button type="submit">Start</button>
    </form>

    <div id="status" class="hidden">
      <div id="statusText"></div>
      <progress id="progressBar" max="100" value="0"></progress>
      <div id="error" style="color:#b00;"></div>
      <button id="downloadBtn" class="hidden">Download</button>
    </div>
  </section>

  <section id="history" class="hidden">
    <h3>Your Jobs</h3>
    <table id="videoTable">
      <thead>
        <tr>
          <th>File</th>
          <th>WxH</th>
          <th>Codec</th>
          <th>Duration</th>
          <th>Size</th>
          <th>Uploaded</th>
          <th>Status</th>
          <th>Progress</th>
          <th>Download</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <script src="./app.js"></script>
</body>
</html>
